# HPL Ns, Ps, Qs 計算ツール

GPUクラスタ上で HPL（High-Performance Linpack）ベンチマークの最適パラメータである Ns（Problem Size）、NB（Block Size）、P×Q（プロセス分割）を簡単に計算するための Web UI ツールです。Gradio を用いて、ブラウザ上から直感的にパラメータを入力・調整できます。

## 特長
- **ブラウザ UI**：Gradio によるシンプルなフォーム入力
- **自動計算**：与えられた GPU 数・メモリ容量・使用率・ブロックサイズから Ns, P, Q を一括算出
- **平方根に近い P×Q**：プロセス分割（P×Q）は GPU 数の約平方根の因数分解を自動で探索
- **即時フィードバック**：パラメータを変えるたびに結果がリアルタイム更新

## 動作環境
- Python 3.7 以上
- 必要ライブラリ
  - `gradio`
  - （標準ライブラリとして `math` を使用）

## インストール
```bash
# Gradio のインストール
pip install gradio
```

## 使い方
1. リポジトリをクローンまたはスクリプトをダウンロード
2. ターミナルでスクリプトを実行
   ```bash
   python app.py
   ```
3. ブラウザで以下の URL にアクセス
   ```
   http://0.0.0.0:7860/
   ```
4. UI 上で以下のパラメータを入力して「Submit」
   * **GPU数**：ノードあたりの GPU 数
   * **1枚あたりのGPUメモリ容量（MiB）**：GPU 1枚あたり搭載メモリ容量（MiB 単位）
   * **メモリ使用率**：使用するメモリの割合（0.00～1.00）
   * **ブロックサイズ（NBs）**：HPL のブロックサイズ
5. 計算結果として以下が表示されます
   * **Ns**：Problem Size
   * **NBs**：入力したブロックサイズ
   * **Ps**、**Qs**：プロセス分割の推奨値
6. 表示されたパラメータをもとに `HPL.dat` を生成してください。

## パラメータ詳細
| 項目                  | 説明                                            |
| ------------------- | --------------------------------------------- |
| GPU数                | クラスタノードあたりの GPU 数。整数で指定。                      |
| 1枚あたりのGPUメモリ容量（MiB） | GPU 1 枚あたりの搭載メモリ容量。MiB 単位で入力。                 |
| メモリ使用率              | ベンチマークに割り当てるメモリ割合。0.00 ～ 1.00 の小数で指定。         |
| ブロックサイズ（NBs）        | HPL のブロックサイズ。通常は 64、128、256、512、1024、2048 など。 |

## HPL.dat 生成のヒント
1. `Ns` は総メモリから問題サイズを逆算したもので、2 分割要素（double, 8 バイト）を踏まえたサイズです。
2. `NB` はチューニングポイントとなるブロックサイズ。メモリ帯域やキャッシュ最適化に影響します。
3. `P×Q` は並列プロセス分割。GPU 数を約平方根で近似した因数分解を推奨しています。
4. 生成した `Ns`, `NB`, `P`, `Q` をもとに、HPL の input ファイル（`HPL.dat`）を作成してください。

## カスタマイズ
* ポート番号、ホストバインド先は `iface.launch(server_name="0.0.0.0", server_port=7860)` を編集
* デフォルト値や入力制限は `gr.Number()`／`gr.Slider()` の引数で調整可能
* 計算ロジックを変更したい場合は `estimate_ns()`／`find_best_pq()` を修正
